# ğŸ¨ Visual Authentication Flow

## Complete User Journey with Smart Authentication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER OPENS APP                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    SPLASH SCREEN        â”‚
                    â”‚  (Checking auth...)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Is User Logged In?    â”‚
                    â”‚  (Check SharedPrefs)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â•±          â•²
                          â•±              â•²
                        â•±                  â•²
                      â•±                      â•²
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  YES   â”‚                â”‚    NO    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                          â”‚
                  â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MAIN DASHBOARD         â”‚   â”‚    LOGIN SCREEN          â”‚
    â”‚   (Auto-Login!)          â”‚   â”‚  "Welcome to SafeZoneX"  â”‚
    â”‚   âœ… Skip all auth       â”‚   â”‚                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Click "Sign In with     â”‚
                                    â”‚  Google"                 â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Google Account Picker   â”‚
                                    â”‚  (Select UM Account)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Validate Email Domain   â”‚
                                    â”‚  (@siswa.um.edu.my)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â•±          â•²
                                        â•±              â•²
                                      â•±                  â•²
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Valid   â”‚          â”‚ Invalid â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚                     â”‚
                                    â”‚                     â–¼
                                    â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚           â”‚  âŒ Error:       â”‚
                                    â”‚           â”‚  "Only UM emails â”‚
                                    â”‚           â”‚   allowed"       â”‚
                                    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  ğŸ” CHECK DATABASE       â”‚
                          â”‚  API: /api/users/check   â”‚
                          â”‚  Does user exist?        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â•±              â•²
                              â•±                  â•²
                            â•±                      â•²
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   YES    â”‚              â”‚    NO    â”‚
                    â”‚ (Exists) â”‚              â”‚  (New)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                         â”‚
                          â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  âœ… AUTO-LOGIN!          â”‚   â”‚  PERSONAL DETAILS SCREEN â”‚
        â”‚  - Save credentials      â”‚   â”‚  "Complete your profile" â”‚
        â”‚  - "Welcome back, [Name]"â”‚   â”‚                          â”‚
        â”‚  - Skip registration     â”‚   â”‚  Fields:                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â€¢ Phone Number          â”‚
                    â”‚                   â”‚  â€¢ Student ID            â”‚
                    â”‚                   â”‚  â€¢ Year                  â”‚
                    â”‚                   â”‚  â€¢ Faculty               â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â–¼
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚  Click "Complete         â”‚
                    â”‚                   â”‚  Registration"           â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â–¼
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚  API: /api/users/registerâ”‚
                    â”‚                   â”‚  - Check duplicates      â”‚
                    â”‚                   â”‚  - Create new user       â”‚
                    â”‚                   â”‚  - Save to MongoDB       â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â–¼
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚  âœ… Registration Success â”‚
                    â”‚                   â”‚  - Save credentials      â”‚
                    â”‚                   â”‚  - Set isLoggedIn=true   â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    MAIN DASHBOARD        â”‚
                      â”‚  â€¢ Home                  â”‚
                      â”‚  â€¢ Walk with Me          â”‚
                      â”‚  â€¢ Friends               â”‚
                      â”‚  â€¢ Reports               â”‚
                      â”‚  â€¢ Profile               â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ (User navigates to Profile)
                                    â”‚
                                    â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   PROFILE SCREEN         â”‚
                      â”‚  â€¢ User Info             â”‚
                      â”‚  â€¢ Settings              â”‚
                      â”‚  â€¢ ğŸšª Sign Out           â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ (Click Sign Out)
                                    â”‚
                                    â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  Confirmation Dialog     â”‚
                      â”‚  "Are you sure?"         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  ğŸ“¤ LOGOUT PROCESS       â”‚
                      â”‚  1. Google sign out      â”‚
                      â”‚  2. Clear credentials    â”‚
                      â”‚  3. Set isLoggedIn=false â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    LOGIN SCREEN          â”‚
                      â”‚  (Can sign in again)     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                     â”‚
                          (Loop back to "Sign In with Google")
```

---

## ğŸ¯ Key Decision Points

### Decision 1: Is User Logged In?
- **Check:** `SharedPreferences` â†’ `is_logged_in` flag
- **YES:** Direct to Dashboard (skip auth)
- **NO:** Show Login Screen

### Decision 2: Valid Email Domain?
- **Check:** Email ends with `@siswa.um.edu.my`
- **YES:** Continue to database check
- **NO:** Show error, reject sign in

### Decision 3: Does User Exist in Database?
- **Check:** API call to `/api/users/check?email={email}`
- **EXISTS:** Auto-login (skip registration)
- **NEW:** Show Personal Details Screen

---

## ğŸ”„ State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SHARED PREFERENCES                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ user_id: "uuid"                                      â”‚
â”‚  â€¢ user_email: "student@siswa.um.edu.my"               â”‚
â”‚  â€¢ user_name: "Student Name"                            â”‚
â”‚  â€¢ is_logged_in: true/false                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
         â”‚ (On Login)                         â”‚ (On Logout)
         â–¼                                    â–¼
    Save All Data                         Clear All Data
    Set is_logged_in = true               Set is_logged_in = false
```

---

## ğŸ“Š API Flow

### Check User Exists
```
Frontend                    Backend                   MongoDB
   â”‚                           â”‚                         â”‚
   â”œâ”€â”€â”€â”€ GET /api/users/check â”€â”¤                         â”‚
   â”‚        ?email=xxx         â”‚                         â”‚
   â”‚                           â”œâ”€â”€â”€ Find by email â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                         â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€ Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                         â”‚
   â”‚â—„â”€â”€â”€ Response: exists=true/false + user data â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                         â”‚
```

### Register User
```
Frontend                    Backend                   MongoDB
   â”‚                           â”‚                         â”‚
   â”œâ”€ POST /api/users/registerâ”¤                         â”‚
   â”‚     {email, name, etc}   â”‚                         â”‚
   â”‚                           â”œâ”€ Check email exists â”€â”€â”€â”€â”¤
   â”‚                           â”‚                         â”‚
   â”‚                           â”œâ”€ Check studentId exists â”¤
   â”‚                           â”‚                         â”‚
   â”‚                           â”œâ”€ If both unique â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚   Create new user       â”‚
   â”‚                           â”‚                         â”‚
   â”‚â—„â”€â”€â”€ Response: user object â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                         â”‚
```

---

## ğŸ¨ UI States

### Splash Screen States
```
Loading â†’ Checking Auth â†’ Navigate
   â”‚            â”‚              â”‚
   â””â”€ Progress Bar            â””â”€ Fade Transition
        â””â”€ Status Text
```

### Login Screen States
```
Idle â†’ Loading â†’ Success/Error
 â”‚        â”‚           â”‚
 â””â”€ Show Form        â””â”€ Navigate/Show Error
     â””â”€ Google Button
```

### Registration Flow States
```
Personal Details â†’ Validating â†’ Saving â†’ Success
       â”‚               â”‚          â”‚         â”‚
       â””â”€ Form Input   â””â”€ API    â””â”€ DB    â””â”€ Navigate
```

---

## ğŸ‰ Success Indicators

### âœ… First Time User
```
Google Sign-In âœ…
  â†“
Personal Details âœ…
  â†“
Registration âœ… "Account created successfully!"
  â†“
Dashboard âœ…
```

### âœ… Returning User
```
Google Sign-In âœ…
  â†“
Database Check âœ… User found!
  â†“
Auto-Login âœ… "Welcome back, [Name]!"
  â†“
Dashboard âœ…
```

### âœ… After Sign Out
```
Sign Out âœ… "Signed out successfully"
  â†“
Login Screen âœ…
  â†“
Google Sign-In âœ…
  â†“
Auto-Login âœ… "Welcome back!"
```

---

## ğŸ“± Device Scenarios

### Same Device - App Restart
```
Close App â†’ Reopen App
     â†“
Check is_logged_in = true
     â†“
Auto-Login to Dashboard âœ…
```

### Different Device - Same Account
```
New Device â†’ Sign In with Google
     â†“
Check Database â†’ User Exists
     â†“
Auto-Login to Dashboard âœ…
(No duplicate created!)
```

---

**Visual Flow Version:** 2.0  
**Last Updated:** October 2, 2025  
**Status:** âœ… Complete Implementation
